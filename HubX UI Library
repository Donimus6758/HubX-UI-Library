--[[
    HubX UI Library v3
    Стиль: матовый тёмный минимализм, поддержка ПК / планшетов / телефонов.

    Пример использования:

    local HubX = loadstring(game:HttpGet("YOUR_RAW_URL_HERE"))()
    local Window = HubX:CreateWindow({
        Title = "HubX",
        SubTitle = "By Donimus",
        Key = "hubx_example"
    })

    local Main = Window:CreateTab("Main")

    local runButton = Main:CreateButton({
        Text = "Запустить скрипт",
        ButtonText = "Run", -- <= тут меняешь текст кнопки
        Callback = function()
            print("run clicked")
        end
    })

    runButton:SetButtonText("Execute") -- можно менять в рантайме
]]

local HubX = {}
HubX.__index = HubX

local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- ========= THEME =========

HubX.Theme = {
    Background      = Color3.fromRGB(14, 16, 22),
    BackgroundAlt   = Color3.fromRGB(18, 21, 30),
    TopBar          = Color3.fromRGB(20, 23, 33),
    Sidebar         = Color3.fromRGB(19, 22, 31),
    Element         = Color3.fromRGB(24, 28, 40),
    ElementDark     = Color3.fromRGB(20, 23, 34),
    ElementOutline  = Color3.fromRGB(45, 52, 72),

    Accent          = Color3.fromRGB(0, 153, 255),
    AccentDark      = Color3.fromRGB(0, 122, 204),

    Text            = Color3.fromRGB(230, 235, 255),
    TextMuted       = Color3.fromRGB(130, 140, 160),
    Danger          = Color3.fromRGB(255, 85, 105),
    Success         = Color3.fromRGB(0, 200, 120)
}

-- ========= UTILS =========

local function getParentGui()
    local ok, res = pcall(function()
        return gethui and gethui()
    end)
    if ok and res then
        return res
    end

    if syn and syn.protect_gui then
        local gui = Instance.new("ScreenGui")
        syn.protect_gui(gui)
        gui.Name = "HubX_UI"
        gui.ZIndexBehavior = Enum.ZIndexBehavior.Global
        gui.ResetOnSpawn = false
        gui.IgnoreGuiInset = true
        gui.Parent = game:GetService("CoreGui")
        return gui
    end

    local coreGui = game:GetService("CoreGui")
    if coreGui then
        local gui = Instance.new("ScreenGui")
        gui.Name = "HubX_UI"
        gui.ZIndexBehavior = Enum.ZIndexBehavior.Global
        gui.ResetOnSpawn = false
        gui.IgnoreGuiInset = true
        gui.Parent = coreGui
        return gui
    end

    local playerGui = LocalPlayer:WaitForChild("PlayerGui")
    local gui = Instance.new("ScreenGui")
    gui.Name = "HubX_UI"
    gui.ZIndexBehavior = Enum.ZIndexBehavior.Global
    gui.ResetOnSpawn = false
    gui.IgnoreGuiInset = true
    gui.Parent = playerGui
    return gui
end

local function makeDraggable(frame, dragHandle)
    dragHandle = dragHandle or frame
    local dragging = false
    local dragStart, startPos

    dragHandle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1
        or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    UIS.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement
        or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(
                startPos.X.Scale,
                startPos.X.Offset + delta.X,
                startPos.Y.Scale,
                startPos.Y.Offset + delta.Y
            )
        end
    end)
end

local function tween(obj, info, props)
    local t = TweenService:Create(obj, info, props)
    t:Play()
    return t
end

-- базовый контейнер для элементов внутри таба
local function createElementBase(tabMethods, height)
    local theme = HubX.Theme
    local content = tabMethods._content

    local item = Instance.new("Frame")
    item.Name = "Item"
    item.BackgroundColor3 = theme.Element
    item.BorderSizePixel = 0
    item.Size = UDim2.new(1, 0, 0, height or 42)
    item.ZIndex = 5
    item.Parent = content

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = item

    local stroke = Instance.new("UIStroke")
    stroke.Color = theme.ElementOutline
    stroke.Thickness = 1
    stroke.Transparency = 0.4
    stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    stroke.Parent = item

    local padding = Instance.new("UIPadding")
    padding.PaddingLeft = UDim.new(0, 10)
    padding.PaddingRight = UDim.new(0, 10)
    padding.PaddingTop = UDim.new(0, 8)
    padding.PaddingBottom = UDim.new(0, 8)
    padding.Parent = item

    return item
end

-- ========= WINDOW =========

function HubX:CreateWindow(options)
    options = options or {}
    local theme = HubX.Theme

    local parent = getParentGui()

    local window = Instance.new("Frame")
    window.Name = "HubX_Window"
    window.AnchorPoint = Vector2.new(0.5, 0.5)
    window.Position = UDim2.new(0.5, 0, 0.5, 0)
    window.Size = UDim2.new(0, 580, 0, 350)
    window.BackgroundColor3 = theme.Background
    window.BorderSizePixel = 0
    window.ZIndex = 1
    window.Parent = parent

    local windowCorner = Instance.new("UICorner")
    windowCorner.CornerRadius = UDim.new(0, 10)
    windowCorner.Parent = window

    local windowStroke = Instance.new("UIStroke")
    windowStroke.Color = theme.ElementOutline
    windowStroke.Thickness = 1
    windowStroke.Transparency = 0.4
    windowStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    windowStroke.Parent = window

    -- Топбар
    local topbar = Instance.new("Frame")
    topbar.Name = "Topbar"
    topbar.BackgroundColor3 = theme.TopBar
    topbar.BorderSizePixel = 0
    topbar.Size = UDim2.new(1, 0, 0, 32)
    topbar.ZIndex = 2
    topbar.Parent = window

    local topCorner = Instance.new("UICorner")
    topCorner.CornerRadius = UDim.new(0, 10)
    topCorner.Parent = topbar

    local title = Instance.new("TextLabel")
    title.Name = "Title"
    title.AnchorPoint = Vector2.new(0, 0.5)
    title.Position = UDim2.new(0, 14, 0.5, -2)
    title.BackgroundTransparency = 1
    title.Size = UDim2.new(1, -80, 1, 0)
    title.Font = Enum.Font.GothamBold
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.TextSize = 16
    title.TextColor3 = theme.Text
    title.Text = tostring(options.Title or "HubX")
    title.ZIndex = 3
    title.Parent = topbar

    local subtitle = Instance.new("TextLabel")
    subtitle.Name = "SubTitle"
    subtitle.AnchorPoint = Vector2.new(0, 0.5)
    subtitle.Position = UDim2.new(0, 14, 0.5, 11)
    subtitle.BackgroundTransparency = 1
    subtitle.Size = UDim2.new(1, -80, 1, 0)
    subtitle.Font = Enum.Font.Gotham
    subtitle.TextXAlignment = Enum.TextXAlignment.Left
    subtitle.TextSize = 11
    subtitle.TextColor3 = theme.TextMuted
    subtitle.Text = tostring(options.SubTitle or "")
    subtitle.ZIndex = 3
    subtitle.Parent = topbar

    -- Кнопка закрытия
    local closeBtn = Instance.new("TextButton")
    closeBtn.Name = "Close"
    closeBtn.AnchorPoint = Vector2.new(1, 0.5)
    closeBtn.Position = UDim2.new(1, -10, 0.5, 0)
    closeBtn.Size = UDim2.new(0, 22, 0, 22)
    closeBtn.BackgroundColor3 = theme.Element
    closeBtn.AutoButtonColor = false
    closeBtn.Text = "×"
    closeBtn.Font = Enum.Font.GothamBold
    closeBtn.TextSize = 16
    closeBtn.TextColor3 = theme.Text
    closeBtn.ZIndex = 4
    closeBtn.Parent = topbar

    local closeCorner = Instance.new("UICorner")
    closeCorner.CornerRadius = UDim.new(0, 6)
    closeCorner.Parent = closeBtn

    closeBtn.MouseButton1Click:Connect(function()
        window:Destroy()
    end)

    makeDraggable(window, topbar)

    -- Основная область
    local body = Instance.new("Frame")
    body.Name = "Body"
    body.BackgroundColor3 = theme.Background
    body.BorderSizePixel = 0
    body.Position = UDim2.new(0, 0, 0, 32)
    body.Size = UDim2.new(1, 0, 1, -32)
    body.ZIndex = 1
    body.Parent = window

    local bodyCorner = Instance.new("UICorner")
    bodyCorner.CornerRadius = UDim.new(0, 10)
    bodyCorner.Parent = body

    -- Sidebar (Tabs)
    local sidebar = Instance.new("Frame")
    sidebar.Name = "Sidebar"
    sidebar.BackgroundColor3 = theme.Sidebar
    sidebar.BorderSizePixel = 0
    sidebar.Position = UDim2.new(0, 0, 0, 0)
    sidebar.Size = UDim2.new(0, 150, 1, 0)
    sidebar.ZIndex = 1
    sidebar.Parent = body

    local sidebarCorner = Instance.new("UICorner")
    sidebarCorner.CornerRadius = UDim.new(0, 10)
    sidebarCorner.Parent = sidebar

    local sidebarPadding = Instance.new("UIPadding")
    sidebarPadding.PaddingTop = UDim.new(0, 8)
    sidebarPadding.PaddingBottom = UDim.new(0, 8)
    sidebarPadding.PaddingLeft = UDim.new(0, 8)
    sidebarPadding.PaddingRight = UDim.new(0, 6)
    sidebarPadding.Parent = sidebar

    -- scrollable Tabs
    local tabList = Instance.new("ScrollingFrame")
    tabList.Name = "TabList"
    tabList.BackgroundTransparency = 1
    tabList.BorderSizePixel = 0
    tabList.Size = UDim2.new(1, 0, 1, 0)
    tabList.CanvasSize = UDim2.new(0, 0, 0, 0)
    tabList.ScrollBarThickness = 3
    tabList.ScrollBarImageColor3 = Color3.fromRGB(80, 84, 98)
    tabList.VerticalScrollBarInset = Enum.ScrollBarInset.Always
    tabList.ZIndex = 2
    tabList.Parent = sidebar

    local tabLayout = Instance.new("UIListLayout")
    tabLayout.SortOrder = Enum.SortOrder.LayoutOrder
    tabLayout.Padding = UDim.new(0, 6)
    tabLayout.Parent = tabList

    tabLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        tabList.CanvasSize = UDim2.new(0, 0, 0, tabLayout.AbsoluteContentSize.Y + 10)
    end)

    -- Content area
    local contentHolder = Instance.new("Frame")
    contentHolder.Name = "ContentHolder"
    contentHolder.BackgroundColor3 = theme.BackgroundAlt
    contentHolder.BorderSizePixel = 0
    contentHolder.Position = UDim2.new(0, 150, 0, 0)
    contentHolder.Size = UDim2.new(1, -150, 1, 0)
    contentHolder.ZIndex = 1
    contentHolder.Parent = body

    local contentCorner = Instance.new("UICorner")
    contentCorner.CornerRadius = UDim.new(0, 10)
    contentCorner.Parent = contentHolder

    local contentPages = Instance.new("Frame")
    contentPages.Name = "Pages"
    contentPages.BackgroundTransparency = 1
    contentPages.Size = UDim2.new(1, -16, 1, -16)
    contentPages.Position = UDim2.new(0, 8, 0, 8)
    contentPages.Parent = contentHolder

    local pageLayout = Instance.new("UIPageLayout")
    pageLayout.SortOrder = Enum.SortOrder.LayoutOrder
    pageLayout.Padding = UDim.new(0, 6)
    pageLayout.TweenTime = 0.18
    pageLayout.EasingDirection = Enum.EasingDirection.Out
    pageLayout.EasingStyle = Enum.EasingStyle.Quad
    pageLayout.FillDirection = Enum.FillDirection.Horizontal
    pageLayout.Parent = contentPages

    local WindowObject = {
        _tabs = {},
        _firstTab = nil
    }
    setmetatable(WindowObject, HubX)

    -- TAB METHODS
    local function createTabMethods(pageFrame)
        local TabMethods = {}
        TabMethods._content = pageFrame

        -- Layout + padding
        local list = Instance.new("UIListLayout")
        list.SortOrder = Enum.SortOrder.LayoutOrder
        list.Padding = UDim.new(0, 8)
        list.Parent = pageFrame

        local pad = Instance.new("UIPadding")
        pad.PaddingTop = UDim.new(0, 8)
        pad.PaddingBottom = UDim.new(0, 8)
        pad.PaddingLeft = UDim.new(0, 8)
        pad.PaddingRight = UDim.new(0, 8)
        pad.Parent = pageFrame

        -- LABEL
        function TabMethods:CreateLabel(opts)
            opts = opts or {}
            local text = opts.Text or "Label"
            local theme = HubX.Theme

            local item = createElementBase(self, 32)
            local lbl = Instance.new("TextLabel")
            lbl.BackgroundTransparency = 1
            lbl.Size = UDim2.new(1, 0, 1, 0)
            lbl.Font = Enum.Font.Gotham
            lbl.TextSize = 14
            lbl.TextColor3 = theme.Text
            lbl.TextXAlignment = Enum.TextXAlignment.Left
            lbl.Text = text
            lbl.ZIndex = 6
            lbl.Parent = item

            return {
                SetText = function(_, t)
                    lbl.Text = t
                end
            }
        end

        -- BUTTON (styled, custom action text)
        function TabMethods:CreateButton(opts)
            opts = opts or {}
            local text = opts.Text or "Button"
            local actionText = opts.ButtonText or "Execute"
            local width = tonumber(opts.ButtonWidth) or 100
            local callback = opts.Callback or function() end
            local theme = HubX.Theme

            local item = createElementBase(self, 44)

            local label = Instance.new("TextLabel")
            label.Name = "Label"
            label.BackgroundTransparency = 1
            label.Size = UDim2.new(1, -(width + 22 + 12), 1, 0)
            label.Font = Enum.Font.Gotham
            label.Text = text
            label.TextSize = 14
            label.TextColor3 = theme.Text
            label.TextXAlignment = Enum.TextXAlignment.Left
            label.ZIndex = 6
            label.Parent = item

            local btn = Instance.new("TextButton")
            btn.Name = "Action"
            btn.AnchorPoint = Vector2.new(1, 0.5)
            btn.Position = UDim2.new(1, -6, 0.5, 0)
            btn.Size = UDim2.new(0, width, 0, 28)
            btn.BackgroundColor3 = theme.Accent
            btn.AutoButtonColor = false
            btn.Text = ""
            btn.ZIndex = 7
            btn.Parent = item

            local btnCorner = Instance.new("UICorner")
            btnCorner.CornerRadius = UDim.new(0, 8)
            btnCorner.Parent = btn

            local btnStroke = Instance.new("UIStroke")
            btnStroke.Color = theme.ElementOutline
            btnStroke.Thickness = 1
            btnStroke.Transparency = 0.3
            btnStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
            btnStroke.Parent = btn

            local shadow = Instance.new("ImageLabel")
            shadow.Name = "Shadow"
            shadow.AnchorPoint = Vector2.new(0.5, 0.5)
            shadow.Position = UDim2.new(0.5, 0, 0.5, 3)
            shadow.Size = UDim2.new(1, 10, 1, 10)
            shadow.BackgroundTransparency = 1
            shadow.Image = "rbxassetid://5028857084"
            shadow.ImageTransparency = 0.6
            shadow.ImageColor3 = Color3.fromRGB(0,0,0)
            shadow.ScaleType = Enum.ScaleType.Slice
            shadow.SliceCenter = Rect.new(24,24,276,276)
            shadow.ZIndex = 6
            shadow.Parent = btn

            local btnText = Instance.new("TextLabel")
            btnText.Name = "Text"
            btnText.BackgroundTransparency = 1
            btnText.Size = UDim2.new(1, 0, 1, 0)
            btnText.Font = Enum.Font.GothamBold
            btnText.Text = tostring(actionText)
            btnText.TextSize = 13
            btnText.TextColor3 = Color3.fromRGB(255, 255, 255)
            btnText.ZIndex = 8
            btnText.Parent = btn

            local function hover(on)
                local target = on and theme.AccentDark or theme.Accent
                tween(btn, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                    BackgroundColor3 = target
                })
            end
            local function press(on)
                local scale = on and UDim2.new(0, width-2, 0, 26) or UDim2.new(0, width, 0, 28)
                tween(btn, TweenInfo.new(0.08, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                    Size = scale
                })
            end

            btn.MouseEnter:Connect(function() hover(true) end)
            btn.MouseLeave:Connect(function() hover(false) end)
            btn.MouseButton1Down:Connect(function() press(true) end)
            btn.MouseButton1Up:Connect(function() press(false) end)

            btn.MouseButton1Click:Connect(function()
                task.spawn(function()
                    pcall(callback)
                end)
            end)

            return {
                SetText = function(_, t)
                    label.Text = t
                end,
                SetButtonText = function(_, t)
                    btnText.Text = tostring(t)
                end,
                SetCallback = function(_, cb)
                    if typeof(cb) == "function" then
                        callback = cb
                    end
                end
            }
        end

        -- TOGGLE
        function TabMethods:CreateToggle(opts)
            opts = opts or {}
            local text = opts.Text or "Toggle"
            local default = opts.Default or false
            local callback = opts.Callback or function() end
            local theme = HubX.Theme

            local state = default

            local item = createElementBase(self, 40)

            local label = Instance.new("TextLabel")
            label.BackgroundTransparency = 1
            label.Size = UDim2.new(1, -60, 1, 0)
            label.Font = Enum.Font.Gotham
            label.Text = text
            label.TextSize = 14
            label.TextColor3 = theme.Text
            label.TextXAlignment = Enum.TextXAlignment.Left
            label.ZIndex = 6
            label.Parent = item

            local toggleBtn = Instance.new("TextButton")
            toggleBtn.Name = "Toggle"
            toggleBtn.AnchorPoint = Vector2.new(1, 0.5)
            toggleBtn.Position = UDim2.new(1, -6, 0.5, 0)
            toggleBtn.Size = UDim2.new(0, 38, 0, 20)
            toggleBtn.BackgroundColor3 = theme.ElementDark
            toggleBtn.AutoButtonColor = false
            toggleBtn.Text = ""
            toggleBtn.ZIndex = 7
            toggleBtn.Parent = item

            local toggleCorner = Instance.new("UICorner")
            toggleCorner.CornerRadius = UDim.new(1, 0)
            toggleCorner.Parent = toggleBtn

            local circle = Instance.new("Frame")
            circle.Name = "Knob"
            circle.AnchorPoint = Vector2.new(0, 0.5)
            circle.Position = UDim2.new(0, 2, 0.5, 0)
            circle.Size = UDim2.new(0, 16, 0, 16)
            circle.BackgroundColor3 = Color3.fromRGB(220, 225, 255)
            circle.BorderSizePixel = 0
            circle.ZIndex = 8
            circle.Parent = toggleBtn

            local circleCorner = Instance.new("UICorner")
            circleCorner.CornerRadius = UDim.new(1, 0)
            circleCorner.Parent = circle

            local function apply(val)
                state = val
                if val then
                    tween(toggleBtn, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                        BackgroundColor3 = theme.Accent
                    })
                    tween(circle, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                        Position = UDim2.new(1, -18, 0.5, 0)
                    })
                else
                    tween(toggleBtn, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                        BackgroundColor3 = theme.ElementDark
                    })
                    tween(circle, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                        Position = UDim2.new(0, 2, 0.5, 0)
                    })
                end
                task.spawn(function()
                    pcall(callback, state)
                end)
            end

            apply(default)

            toggleBtn.MouseButton1Click:Connect(function()
                apply(not state)
            end)

            return {
                Set = function(_, val)
                    apply(val)
                end,
                Get = function()
                    return state
                end
            }
        end

        -- SLIDER
        function TabMethods:CreateSlider(opts)
            opts = opts or {}
            local text = opts.Text or "Slider"
            local min = tonumber(opts.Min) or 0
            local max = tonumber(opts.Max) or 100
            local default = tonumber(opts.Default) or min
            local suffix = opts.Suffix or ""
            local callback = opts.Callback or function() end
            local theme = HubX.Theme

            if default < min then default = min end
            if default > max then default = max end

            local value = default

            local item = createElementBase(self, 60)

            local label = Instance.new("TextLabel")
            label.BackgroundTransparency = 1
            label.Size = UDim2.new(1, 0, 0, 18)
            label.Font = Enum.Font.Gotham
            label.TextSize = 14
            label.TextColor3 = theme.Text
            label.TextXAlignment = Enum.TextXAlignment.Left
            label.Text = text
            label.ZIndex = 6
            label.Parent = item

            local valueLabel = Instance.new("TextLabel")
            valueLabel.BackgroundTransparency = 1
            valueLabel.AnchorPoint = Vector2.new(1, 0)
            valueLabel.Position = UDim2.new(1, 0, 0, 0)
            valueLabel.Size = UDim2.new(0, 80, 0, 18)
            valueLabel.Font = Enum.Font.Gotham
            valueLabel.TextSize = 12
            valueLabel.TextColor3 = theme.TextMuted
            valueLabel.TextXAlignment = Enum.TextXAlignment.Right
            valueLabel.ZIndex = 6
            valueLabel.Parent = item

            local bar = Instance.new("Frame")
            bar.Name = "Bar"
            bar.AnchorPoint = Vector2.new(0.5, 1)
            bar.Position = UDim2.new(0.5, 0, 1, -6)
            bar.Size = UDim2.new(1, -10, 0, 6)
            bar.BackgroundColor3 = theme.ElementDark
            bar.BorderSizePixel = 0
            bar.ZIndex = 6
            bar.Parent = item

            local barCorner = Instance.new("UICorner")
            barCorner.CornerRadius = UDim.new(1, 0)
            barCorner.Parent = bar

            local fill = Instance.new("Frame")
            fill.Name = "Fill"
            fill.AnchorPoint = Vector2.new(0, 0.5)
            fill.Position = UDim2.new(0, 0, 0.5, 0)
            fill.Size = UDim2.new(0, 0, 1, 0)
            fill.BackgroundColor3 = theme.Accent
            fill.BorderSizePixel = 0
            fill.ZIndex = 7
            fill.Parent = bar

            local fillCorner = Instance.new("UICorner")
            fillCorner.CornerRadius = UDim.new(1, 0)
            fillCorner.Parent = fill

            local dragCircle = Instance.new("Frame")
            dragCircle.Name = "Knob"
            dragCircle.AnchorPoint = Vector2.new(0.5, 0.5)
            dragCircle.Position = UDim2.new(0, 0, 0.5, 0)
            dragCircle.Size = UDim2.new(0, 12, 0, 12)
            dragCircle.BackgroundColor3 = Color3.fromRGB(240, 245, 255)
            dragCircle.BorderSizePixel = 0
            dragCircle.ZIndex = 8
            dragCircle.Parent = bar

            local dragCorner = Instance.new("UICorner")
            dragCorner.CornerRadius = UDim.new(1, 0)
            dragCorner.Parent = dragCircle

            local dragging = false

            local function setValueFromX(x)
                local rel = math.clamp((x - bar.AbsolutePosition.X) / bar.AbsoluteSize.X, 0, 1)
                local newVal = math.floor((min + (max - min) * rel) + 0.5)
                value = newVal
                valueLabel.Text = tostring(newVal) .. suffix

                fill.Size = UDim2.new(rel, 0, 1, 0)
                dragCircle.Position = UDim2.new(rel, 0, 0.5, 0)

                task.spawn(function()
                    pcall(callback, value)
                end)
            end

            bar.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1
                    or input.UserInputType == Enum.UserInputType.Touch then
                    dragging = true
                    setValueFromX(input.Position.X)
                end
            end)

            dragCircle.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1
                    or input.UserInputType == Enum.UserInputType.Touch then
                    dragging = true
                    setValueFromX(input.Position.X)
                end
            end)

            UIS.InputChanged:Connect(function(input)
                if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement
                    or input.UserInputType == Enum.UserInputType.Touch) then
                    setValueFromX(input.Position.X)
                end
            end)

            UIS.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1
                    or input.UserInputType == Enum.UserInputType.Touch then
                    dragging = false
                end
            end)

            -- apply default
            local function apply(v)
                v = math.clamp(v, min, max)
                local rel = (v - min) / (max - min)
                value = v
                valueLabel.Text = tostring(v) .. suffix
                fill.Size = UDim2.new(rel, 0, 1, 0)
                dragCircle.Position = UDim2.new(rel, 0, 0.5, 0)
                task.spawn(function()
                    pcall(callback, value)
                end)
            end

            apply(default)

            return {
                Set = function(_, v)
                    apply(v)
                end,
                Get = function()
                    return value
                end
            }
        end

        -- DROPDOWN (single select)
        function TabMethods:CreateDropdown(opts)
            opts = opts or {}
            local text = opts.Text or "Dropdown"
            local list = opts.List or {}
            local default = opts.Default
            local callback = opts.Callback or function() end
            local theme = HubX.Theme

            local current = default or (list[1] or "")

            local item = createElementBase(self, 44)

            local label = Instance.new("TextLabel")
            label.BackgroundTransparency = 1
            label.Size = UDim2.new(1, -120, 1, 0)
            label.Font = Enum.Font.Gotham
            label.Text = text
            label.TextSize = 14
            label.TextColor3 = theme.Text
            label.TextXAlignment = Enum.TextXAlignment.Left
            label.ZIndex = 6
            label.Parent = item

            local btn = Instance.new("TextButton")
            btn.Name = "DropdownButton"
            btn.AnchorPoint = Vector2.new(1, 0.5)
            btn.Position = UDim2.new(1, -6, 0.5, 0)
            btn.Size = UDim2.new(0, 150, 0, 28)
            btn.BackgroundColor3 = theme.ElementDark
            btn.AutoButtonColor = false
            btn.Text = ""
            btn.ZIndex = 7
            btn.Parent = item

            local btnCorner = Instance.new("UICorner")
            btnCorner.CornerRadius = UDim.new(0, 8)
            btnCorner.Parent = btn

            local btnStroke = Instance.new("UIStroke")
            btnStroke.Color = theme.ElementOutline
            btnStroke.Thickness = 1
            btnStroke.Transparency = 0.4
            btnStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
            btnStroke.Parent = btn

            local selectedLbl = Instance.new("TextLabel")
            selectedLbl.Name = "Selected"
            selectedLbl.BackgroundTransparency = 1
            selectedLbl.AnchorPoint = Vector2.new(0, 0.5)
            selectedLbl.Position = UDim2.new(0, 8, 0.5, 0)
            selectedLbl.Size = UDim2.new(1, -28, 1, 0)
            selectedLbl.Font = Enum.Font.Gotham
            selectedLbl.TextSize = 13
            selectedLbl.TextColor3 = theme.Text
            selectedLbl.TextXAlignment = Enum.TextXAlignment.Left
            selectedLbl.ZIndex = 8
            selectedLbl.Text = tostring(current)
            selectedLbl.Parent = btn

            local arrow = Instance.new("TextLabel")
            arrow.Name = "Arrow"
            arrow.BackgroundTransparency = 1
            arrow.AnchorPoint = Vector2.new(1, 0.5)
            arrow.Position = UDim2.new(1, -6, 0.5, 0)
            arrow.Size = UDim2.new(0, 12, 0, 12)
            arrow.Font = Enum.Font.GothamBold
            arrow.Text = "▼"
            arrow.TextSize = 12
            arrow.TextColor3 = theme.TextMuted
            arrow.ZIndex = 8
            arrow.Parent = btn

            -- список
            local listFrame = Instance.new("Frame")
            listFrame.Name = "DropdownList"
            listFrame.BackgroundColor3 = theme.ElementDark
            listFrame.BorderSizePixel = 0
            listFrame.Size = UDim2.new(1, 0, 0, 0)
            listFrame.Position = UDim2.new(0, 0, 1, 4)
            listFrame.ClipsDescendants = true
            listFrame.Visible = false
            listFrame.ZIndex = 50
            listFrame.Parent = item

            local listCorner = Instance.new("UICorner")
            listCorner.CornerRadius = UDim.new(0, 8)
            listCorner.Parent = listFrame

            local listStroke = Instance.new("UIStroke")
            listStroke.Color = theme.ElementOutline
            listStroke.Thickness = 1
            listStroke.Transparency = 0.4
            listStroke.Parent = listFrame

            local scroll = Instance.new("ScrollingFrame")
            scroll.Name = "Scroll"
            scroll.BackgroundTransparency = 1
            scroll.BorderSizePixel = 0
            scroll.Size = UDim2.new(1, -4, 1, -4)
            scroll.Position = UDim2.new(0, 2, 0, 2)
            scroll.CanvasSize = UDim2.new(0, 0, 0, 0)
            scroll.ScrollBarThickness = 3
            scroll.ScrollBarImageColor3 = Color3.fromRGB(90, 94, 110)
            scroll.ZIndex = 51
            scroll.Parent = listFrame

            local layout = Instance.new("UIListLayout")
            layout.SortOrder = Enum.SortOrder.LayoutOrder
            layout.Padding = UDim.new(0, 2)
            layout.Parent = scroll

            layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
                local total = layout.AbsoluteContentSize.Y
                scroll.CanvasSize = UDim2.new(0, 0, 0, total)
                local maxHeight = 180
                local newH = math.min(total + 4, maxHeight)
                listFrame.Size = UDim2.new(1, 0, 0, newH)
            end)

            local function rebuild()
                for _, c in ipairs(scroll:GetChildren()) do
                    if c:IsA("TextButton") then
                        c:Destroy()
                    end
                end

                for _, opt in ipairs(list) do
                    local optBtn = Instance.new("TextButton")
                    optBtn.BackgroundColor3 = theme.Element
                    optBtn.BorderSizePixel = 0
                    optBtn.Size = UDim2.new(1, 0, 0, 24)
                    optBtn.AutoButtonColor = false
                    optBtn.Text = ""
                    optBtn.ZIndex = 52
                    optBtn.Parent = scroll

                    local cCorner = Instance.new("UICorner")
                    cCorner.CornerRadius = UDim.new(0, 6)
                    cCorner.Parent = optBtn

                    local lbl = Instance.new("TextLabel")
                    lbl.BackgroundTransparency = 1
                    lbl.Size = UDim2.new(1, -10, 1, 0)
                    lbl.Position = UDim2.new(0, 6, 0, 0)
                    lbl.Font = Enum.Font.Gotham
                    lbl.TextXAlignment = Enum.TextXAlignment.Left
                    lbl.TextSize = 13
                    lbl.TextColor3 = theme.Text
                    lbl.Text = tostring(opt)
                    lbl.ZIndex = 53
                    lbl.Parent = optBtn

                    optBtn.MouseEnter:Connect(function()
                        tween(optBtn, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                            BackgroundColor3 = theme.ElementDark
                        })
                    end)
                    optBtn.MouseLeave:Connect(function()
                        tween(optBtn, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                            BackgroundColor3 = theme.Element
                        })
                    end)

                    optBtn.MouseButton1Click:Connect(function()
                        current = opt
                        selectedLbl.Text = tostring(opt)
                        listFrame.Visible = false
                        task.spawn(function()
                            pcall(callback, current)
                        end)
                    end)
                end
            end

            rebuild()

            local open = false

            local function setOpen(on)
                open = on
                listFrame.Visible = on
                tween(arrow, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                    Rotation = on and 180 or 0
                })
            end

            btn.MouseButton1Click:Connect(function()
                setOpen(not open)
            end)

            return {
                Set = function(_, val)
                    current = val
                    selectedLbl.Text = tostring(val)
                    task.spawn(function()
                        pcall(callback, current)
                    end)
                end,
                Get = function()
                    return current
                end,
                SetList = function(_, newList)
                    list = newList
                    rebuild()
                end
            }
        end

        -- COLOR PICKER (горизонтальная палитра + яркость)
        function TabMethods:CreateColorPicker(opts)
            opts = opts or {}
            local text = opts.Text or "Color"
            local default = opts.Default or Color3.fromRGB(255, 255, 255)
            local callback = opts.Callback or function() end
            local theme = HubX.Theme

            local color = default
            local h, s, v = Color3.toHSV(default)

            local item = createElementBase(self, 60)

            local label = Instance.new("TextLabel")
            label.BackgroundTransparency = 1
            label.Size = UDim2.new(1, -70, 0, 18)
            label.Font = Enum.Font.Gotham
            label.TextSize = 14
            label.TextColor3 = theme.Text
            label.TextXAlignment = Enum.TextXAlignment.Left
            label.Text = text
            label.ZIndex = 6
            label.Parent = item

            local preview = Instance.new("Frame")
            preview.Name = "Preview"
            preview.AnchorPoint = Vector2.new(1, 0)
            preview.Position = UDim2.new(1, -6, 0, 4)
            preview.Size = UDim2.new(0, 42, 0, 18)
            preview.BackgroundColor3 = color
            preview.BorderSizePixel = 0
            preview.ZIndex = 6
            preview.Parent = item

            local prevCorner = Instance.new("UICorner")
            prevCorner.CornerRadius = UDim.new(0, 6)
            prevCorner.Parent = preview

            local prevStroke = Instance.new("UIStroke")
            prevStroke.Color = theme.ElementOutline
            prevStroke.Thickness = 1
            prevStroke.Transparency = 0.3
            prevStroke.Parent = preview

            local palette = Instance.new("Frame")
            palette.Name = "Palette"
            palette.AnchorPoint = Vector2.new(0, 1)
            palette.Position = UDim2.new(0, 0, 1, -6)
            palette.Size = UDim2.new(1, -80, 0, 14)
            palette.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            palette.BorderSizePixel = 0
            palette.ZIndex = 6
            palette.Parent = item

            local palCorner = Instance.new("UICorner")
            palCorner.CornerRadius = UDim.new(1, 0)
            palCorner.Parent = palette

            local grad = Instance.new("UIGradient")
            grad.Color = ColorSequence.new({
                ColorSequenceKeypoint.new(0.00, Color3.fromRGB(255, 0, 0)),
                ColorSequenceKeypoint.new(0.17, Color3.fromRGB(255, 255, 0)),
                ColorSequenceKeypoint.new(0.33, Color3.fromRGB(0, 255, 0)),
                ColorSequenceKeypoint.new(0.50, Color3.fromRGB(0, 255, 255)),
                ColorSequenceKeypoint.new(0.67, Color3.fromRGB(0, 0, 255)),
                ColorSequenceKeypoint.new(0.83, Color3.fromRGB(255, 0, 255)),
                ColorSequenceKeypoint.new(1.00, Color3.fromRGB(255, 0, 0)),
            })
            grad.Rotation = 0
            grad.Parent = palette

            local brightness = Instance.new("Frame")
            brightness.Name = "Brightness"
            brightness.AnchorPoint = Vector2.new(1, 1)
            brightness.Position = UDim2.new(1, 0, 1, -6)
            brightness.Size = UDim2.new(0, 60, 0, 14)
            brightness.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            brightness.BorderSizePixel = 0
            brightness.ZIndex = 6
            brightness.Parent = item

            local brCorner = Instance.new("UICorner")
            brCorner.CornerRadius = UDim.new(1, 0)
            brCorner.Parent = brightness

            local brGrad = Instance.new("UIGradient")
            brGrad.Color = ColorSequence.new({
                ColorSequenceKeypoint.new(0.00, Color3.new(0, 0, 0)),
                ColorSequenceKeypoint.new(1.00, Color3.new(1, 1, 1)),
            })
            brGrad.Rotation = 0
            brGrad.Parent = brightness

            local palKnob = Instance.new("Frame")
            palKnob.AnchorPoint = Vector2.new(0.5, 0.5)
            palKnob.Position = UDim2.new(h, 0, 0.5, 0)
            palKnob.Size = UDim2.new(0, 10, 0, 16)
            palKnob.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            palKnob.BorderSizePixel = 0
            palKnob.ZIndex = 7
            palKnob.Parent = palette

            local palKCorner = Instance.new("UICorner")
            palKCorner.CornerRadius = UDim.new(1, 0)
            palKCorner.Parent = palKnob

            local brKnob = Instance.new("Frame")
            brKnob.AnchorPoint = Vector2.new(0.5, 0.5)
            brKnob.Position = UDim2.new(1 - v, 0, 0.5, 0)
            brKnob.Size = UDim2.new(0, 10, 0, 16)
            brKnob.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            brKnob.BorderSizePixel = 0
            brKnob.ZIndex = 7
            brKnob.Parent = brightness

            local brKCorner = Instance.new("UICorner")
            brKCorner.CornerRadius = UDim.new(1, 0)
            brKCorner.Parent = brKnob

            local function applyFromHSV(hh, vv)
                color = Color3.fromHSV(hh, 1, vv)
                preview.BackgroundColor3 = color
                task.spawn(function()
                    pcall(callback, color)
                end)
            end

            local function setHueFromX(x)
                local rel = math.clamp((x - palette.AbsolutePosition.X) / palette.AbsoluteSize.X, 0, 1)
                h = rel
                palKnob.Position = UDim2.new(rel, 0, 0.5, 0)
                applyFromHSV(h, v)
            end

            local function setBrightnessFromX(x)
                local rel = math.clamp((x - brightness.AbsolutePosition.X) / brightness.AbsoluteSize.X, 0, 1)
                v = 1 - rel
                brKnob.Position = UDim2.new(rel, 0, 0.5, 0)
                applyFromHSV(h, v)
            end

            local palDragging = false
            local brDragging = false

            palette.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1
                    or input.UserInputType == Enum.UserInputType.Touch then
                    palDragging = true
                    setHueFromX(input.Position.X)
                end
            end)

            palKnob.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1
                    or input.UserInputType == Enum.UserInputType.Touch then
                    palDragging = true
                    setHueFromX(input.Position.X)
                end
            end)

            brightness.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1
                    or input.UserInputType == Enum.UserInputType.Touch then
                    brDragging = true
                    setBrightnessFromX(input.Position.X)
                end
            end)

            brKnob.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1
                    or input.UserInputType == Enum.UserInputType.Touch then
                    brDragging = true
                    setBrightnessFromX(input.Position.X)
                end
            end)

            UIS.InputChanged:Connect(function(input)
                if (input.UserInputType == Enum.UserInputType.MouseMovement
                    or input.UserInputType == Enum.UserInputType.Touch) then
                    if palDragging then
                        setHueFromX(input.Position.X)
                    end
                    if brDragging then
                        setBrightnessFromX(input.Position.X)
                    end
                end
            end)

            UIS.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1
                    or input.UserInputType == Enum.UserInputType.Touch then
                    palDragging = false
                    brDragging = false
                end
            end)

            applyFromHSV(h, v)

            return {
                Set = function(_, c)
                    color = c
                    h,s,v = Color3.toHSV(c)
                    palKnob.Position = UDim2.new(h, 0, 0.5, 0)
                    brKnob.Position = UDim2.new(1 - v, 0, 0.5, 0)
                    preview.BackgroundColor3 = c
                    task.spawn(function()
                        pcall(callback, c)
                    end)
                end,
                Get = function()
                    return color
                end
            }
        end

        -- PLAYER SELECTOR (dropdown с игроками)
        function TabMethods:CreatePlayerSelector(opts)
            opts = opts or {}
            opts.Text = opts.Text or "Player"
            local callback = opts.Callback or function() end

            local playersList = {}
            for _, plr in ipairs(Players:GetPlayers()) do
                table.insert(playersList, plr.Name)
            end

            local dropdown = self:CreateDropdown({
                Text = opts.Text,
                List = playersList,
                Default = playersList[1],
                Callback = function(selectedName)
                    local plr = Players:FindFirstChild(selectedName)
                    task.spawn(function()
                        pcall(callback, plr)
                    end)
                end
            })

            Players.PlayerAdded:Connect(function(plr)
                table.insert(playersList, plr.Name)
                dropdown:SetList(playersList)
            end)

            Players.PlayerRemoving:Connect(function(plr)
                for i, name in ipairs(playersList) do
                    if name == plr.Name then
                        table.remove(playersList, i)
                        break
                    end
                end
                dropdown:SetList(playersList)
            end)

            return dropdown
        end

        return TabMethods
    end

    -- CREATE TAB
    function WindowObject:CreateTab(name)
        local theme = HubX.Theme
        local tabName = name or "Tab"

        local tabBtn = Instance.new("TextButton")
        tabBtn.Name = tabName
        tabBtn.BackgroundColor3 = theme.ElementDark
        tabBtn.BorderSizePixel = 0
        tabBtn.AutoButtonColor = false
        tabBtn.Size = UDim2.new(1, 0, 0, 30)
        tabBtn.Font = Enum.Font.Gotham
        tabBtn.TextSize = 13
        tabBtn.Text = tabName
        tabBtn.TextColor3 = theme.TextMuted
        tabBtn.ZIndex = 3
        tabBtn.Parent = tabList

        local btnCorner = Instance.new("UICorner")
        btnCorner.CornerRadius = UDim.new(0, 7)
        btnCorner.Parent = tabBtn

        local page = Instance.new("ScrollingFrame")
        page.Name = tabName
        page.BackgroundTransparency = 1
        page.BorderSizePixel = 0
        page.Size = UDim2.new(1, 0, 1, 0)
        page.CanvasSize = UDim2.new(0, 0, 0, 0)
        page.ScrollBarThickness = 4
        page.ScrollBarImageColor3 = Color3.fromRGB(90, 94, 110)
        page.ZIndex = 2
        page.Parent = contentPages

        local layout = Instance.new("UIListLayout")
        layout.SortOrder = Enum.SortOrder.LayoutOrder
        layout.Padding = UDim.new(0, 8)
        layout.Parent = page

        layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            page.CanvasSize = UDim2.new(0, 0, 0, layout.AbsoluteContentSize.Y + 20)
        end)

        -- TabMethods
        local tabObj = createTabMethods(page)

        local function setActive(on)
            if on then
                tween(tabBtn, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                    BackgroundColor3 = theme.Element,
                    TextColor3 = theme.Text
                })
            else
                tween(tabBtn, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                    BackgroundColor3 = theme.ElementDark,
                    TextColor3 = theme.TextMuted
                })
            end
        end

        tabBtn.MouseButton1Click:Connect(function()
            pageLayout:JumpTo(page)
            for _, info in pairs(self._tabs) do
                setActive(info.Page == page)
            end
        end)

        if not self._firstTab then
            self._firstTab = page
            pageLayout:JumpTo(page)
            setActive(true)
        end

        table.insert(self._tabs, {
            Button = tabBtn,
            Page = page
        })

        return tabObj
    end

    return WindowObject
end

return HubX
